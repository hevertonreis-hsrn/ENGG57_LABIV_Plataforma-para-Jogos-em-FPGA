#include <io.h>
#include <system.h>

// Registradores internos do master_interface (em bytes)
#define REG_FRAME_WIDTH       0
#define REG_FRAME_HEIGHT      2
#define REG_OFFSET_R          4
#define REG_OFFSET_L		  6
#define REG_OFFSET_START	  8

#define BG_WIDTH			  1920
#define BG_HEIGHT			  1440

int main() {
    int offset = 0;
    int last_btn = 0;

    // Envia modo inicial de frame e start
    IOWR_16DIRECT(MASTER_INTERFACE_BASE, REG_FRAME_WIDTH, BG_WIDTH);
    IOWR_16DIRECT(MASTER_INTERFACE_BASE, REG_FRAME_HEIGHT, BG_HEIGHT);
    IOWR_16DIRECT(MASTER_INTERFACE_BASE, REG_OFFSET_START, 1);

    while (1) {
        int btns = IORD_16DIRECT(KEY_BASE, 0);

        // Detecta borda de botão pressionado (para evitar repetição)
        if (btns != last_btn) {
            if ((btns & 0x01) != 0) {  // botão 01 (direita)
                offset = 111;
                // Atualiza offset no master_interface
				IOWR_16DIRECT(MASTER_INTERFACE_BASE, REG_OFFSET_R, offset);
            } else if ((btns & 0x02) != 0) {  // botão 10 (esquerda)
                offset = 222;
                // Atualiza offset no master_interface
				IOWR_16DIRECT(MASTER_INTERFACE_BASE, REG_OFFSET_L, offset);
            }
        }

        last_btn = btns;
    }

    return 0;
}
